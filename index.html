<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Truffle Store</title>
  <!-- Add Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Custom styles */
    .truffle-container { margin-bottom: 20px; }
    .cart-item { margin-bottom: 10px; }
    #checkout-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0px 4px 6px rgba(0,0,0,0.1);z-index:100 }
    #popup-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 50;}
  </style>
</head>
<body>

  <!-- Truffle Products Grid -->
  <div class="container">
    <div class="row" id="truffle-container"></div>
  </div>

  <!-- Cart -->
  <div>
    <h3>Your Cart</h3>
    <ul id="cart-list"></ul>
    <p id="cart-total">Total: 0 PKR</p>
    <button id="checkout-btn" class="btn btn-primary">Checkout</button>
  </div>

  <!-- Checkout Popup -->
  <div id="checkout-popup">
    <h4>Shipping Information</h4>
    <form id="checkout-form">
      <label for="user-name">Name:</label><br>
      <input type="text" id="user-name" required><br>
      <label for="user-phone">Phone:</label><br>
      <input type="text" id="user-phone" required><br>
      <label for="user-address">Address:</label><br>
      <input type="text" id="user-address" required><br><br>
      <button type="button" id="confirm-checkout" class="btn btn-success">Confirm Checkout</button>
      <button type="button" id="close-popup" class="btn btn-danger">Cancel</button>
    </form>
  </div>

  <!-- Overlay for the popup -->
  <div id="popup-overlay"></div>

  <!-- Hidden Template for Truffle -->
  <div id="truffle-template" class="col-3 truffle-container" style="display: none;">
    <div class="card">
      <img src="" alt="Truffle Image" class="card-img-top">
      <div class="card-body">
        <h5 class="card-title truffle-name"></h5>
        <p class="card-text truffle-desc"></p>
        <input type="number" class="quantity-selector" value="1" min="1">
        <button class="btn btn-primary add-to-cart-btn">Add to Cart</button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Your Custom Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let cart = {};
      const cartList = document.getElementById("cart-list");
      const totalElement = document.getElementById("cart-total");
      const popup = document.getElementById("checkout-popup");
      const overlay = document.getElementById("popup-overlay");
      const checkoutButton = document.getElementById("checkout-btn");
      const closePopupButton = document.getElementById("close-popup");
      const confirmCheckoutButton = document.getElementById("confirm-checkout");

      // Open checkout popup
      checkoutButton.addEventListener("click", () => {
        popup.style.display = "block";
        overlay.style.display = "block";
      });

      // Close checkout popup
      closePopupButton.addEventListener("click", () => {
        popup.style.display = "none";
        overlay.style.display = "none";
      });

      // Add to cart functionality
      function addToCart(name, buttonElement) {
        const quantityInput = buttonElement.parentElement.querySelector(".quantity-selector");
        const quantity = parseInt(quantityInput.value);
        if (cart[name]) {
          cart[name].quantity += quantity;
        } else {
          cart[name] = { quantity, price: 125 };
        }
        updateCart();
      }

      // Remove from cart functionality
      function removeFromCart(name) {
        delete cart[name];
        updateCart();
      }

      // Update quantity in the cart
      function updateQuantity(name, quantity) {
        if (quantity > 0) {
          cart[name].quantity = quantity;
        } else {
          delete cart[name];
        }
        updateCart();
      }

      // Update cart display
      function updateCart() {
        cartList.innerHTML = "";
        let totalCost = 0;
        for (const name in cart) {
          const item = cart[name];
          const cartItem = document.createElement("li");
          cartItem.classList.add("cart-item");
          cartItem.innerHTML = `
            ${name} - ${item.quantity} x 125 PKR = ${item.quantity * item.price} PKR
            <input type="number" value="${item.quantity}" min="1" class="cart-quantity" data-name="${name}">
            <button class="btn btn-sm btn-danger remove-btn" data-name="${name}">Remove</button>
          `;
          cartList.appendChild(cartItem);
          totalCost += item.quantity * item.price;
        }
        totalElement.textContent = `Total: ${totalCost} PKR`;

        // Add Event Listeners for Remove & Update Quantity
        document.querySelectorAll(".remove-btn").forEach((btn) =>
          btn.addEventListener("click", () => removeFromCart(btn.dataset.name))
        );
        document.querySelectorAll(".cart-quantity").forEach((input) =>
          input.addEventListener("change", (e) =>
            updateQuantity(e.target.dataset.name, parseInt(e.target.value))
          )
        );
      }

      // Handle confirm checkout
      confirmCheckoutButton.addEventListener("click", () => {
        const name = document.getElementById("user-name").value;
        const phone = document.getElementById("user-phone").value;
        const address = document.getElementById("user-address").value;

        if (!name || !phone || !address) {
          alert("Please fill in all shipping details.");
          return;
        }

        // Generate WhatsApp message
        let message = `Order Details:\n`;
        let totalCost = 0;
        for (const truffle in cart) {
          const item = cart[truffle];
          message += `${truffle}: ${item.quantity} x 125 PKR = ${item.quantity * item.price} PKR\n`;
          totalCost += item.quantity * item.price;
        }
        message += `Total: ${totalCost} PKR\n\n`;
        message += `Shipping Info:\nName: ${name}\nPhone: ${phone}\nAddress: ${address}`;

        // Open WhatsApp with the generated message
        const encodedMessage = encodeURIComponent(message);
        const whatsappURL = `https://wa.me/923004251375?text=${encodedMessage}`; // Replace 923000000000 with your WhatsApp number
        window.open(whatsappURL, "_blank");

        // Close the popup
        popup.style.display = "none";
        overlay.style.display = "none";
      });

      // Populate Truffles
      const truffleContainer = document.getElementById("truffle-container");
      const truffleData = [
        { name: "Caramel Truffle", desc: "Sweet caramel filling inside.", img: "https://via.placeholder.com/150" },
        { name: "Hazelnut Truffle", desc: "Crunchy hazelnut center.", img: "https://via.placeholder.com/150" },
        { name: "Dark Chocolate Truffle", desc: "Rich dark chocolate taste.", img: "https://via.placeholder.com/150" },
        { name: "Milk Chocolate Truffle", desc: "Creamy milk chocolate truffle.", img: "https://via.placeholder.com/150" },
        { name: "Mint Truffle", desc: "Minty fresh center.", img: "https://via.placeholder.com/150" },
        { name: "Orange Truffle", desc: "Citrus-flavored center.", img: "https://via.placeholder.com/150" },
        { name: "Raspberry Truffle", desc: "Sweet raspberry center.", img: "https://via.placeholder.com/150" },
        { name: "Peanut Butter Truffle", desc: "Smooth peanut butter filling.", img: "https://via.placeholder.com/150" }
      ];

      truffleData.forEach(truffle => {
        const truffleElement = document.getElementById("truffle-template").cloneNode(true);
        truffleElement.style.display = "block";
        truffleElement.querySelector(".truffle-name").textContent = truffle.name;
        truffleElement.querySelector(".truffle-desc").textContent = truffle.desc;
        truffleElement.querySelector(".card-img-top").src = truffle.img;
        truffleElement.querySelector(".add-to-cart-btn").addEventListener("click", function () {
          addToCart(truffle.name, this);
        });
        truffleContainer.appendChild(truffleElement);
      });
    });
  </script>

</body>
</html>
