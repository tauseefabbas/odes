<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odes Truffles</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <h1>Odes Truffles</h1>
    <div class="row" id="product-grid">
        <!-- Product grid will be populated by JavaScript -->
    </div>

    <div class="mt-4">
        <h3>Cart</h3>
        <ul id="cart-list">
            <!-- Cart items will be listed here -->
        </ul>
        <button id="checkoutBtn" class="btn btn-success mt-3">Checkout</button>
    </div>
</div>

<!-- Modal Template for Product Details -->
<div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productModalLabel">Product Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Product details will be populated here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="addToCartBtnModal">Add to Cart</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Template for Address Form -->
<div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addressModalLabel">Enter Shipping Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="address-form">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="text" class="form-control" id="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" class="form-control" id="city" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Full Address</label>
                        <input type="text" class="form-control" id="address" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Array of products
    const products = [
        { name: 'Caramel Truffle', description: 'Delicious caramel-filled chocolate truffle.', price: 125 },
        { name: 'Chocolate Truffle', description: 'Rich chocolate truffle with a creamy filling.', price: 125 },
        { name: 'Strawberry Truffle', description: 'Sweet strawberry-flavored truffle.', price: 125 },
        { name: 'Vanilla Truffle', description: 'Smooth vanilla truffle with a rich taste.', price: 125 },
        { name: 'Hazelnut Truffle', description: 'A crunchy hazelnut-filled chocolate truffle.', price: 125 },
        { name: 'Coffee Truffle', description: 'Coffee-flavored truffle for coffee lovers.', price: 125 },
        { name: 'Mint Truffle', description: 'Refreshing mint chocolate truffle.', price: 125 },
        { name: 'Pistachio Truffle', description: 'Creamy pistachio-filled chocolate truffle.', price: 125 }
    ];

    let cart = [];

    // Function to display products
    function displayProducts() {
        const productGrid = $('#product-grid');
        productGrid.empty(); // Clear existing grid

        products.forEach((product, index) => {
            productGrid.append(`
                <div class="col-md-3 mb-4 truffle">
                    <div class="card">
                        <img class="card-img-top" src="https://via.placeholder.com/150" alt="${product.name}">
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text">${product.description}</p>
                            <p class="card-text">Price: PKR ${product.price}</p>
                            <button class="btn btn-info details-btn" data-toggle="modal" data-target="#productModal" data-index="${index}">Details</button>
                            <button class="btn btn-primary add-to-cart-btn" data-index="${index}">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `);
        });
    }

    // Display products when page loads
    $(document).ready(function() {
        displayProducts();

        // Handle "Details" button click
        $(document).on('click', '.details-btn', function() {
            const index = $(this).data('index');
            const product = products[index];

            // Populate modal with product details
            $('#productModalLabel').text(product.name);
            $('.modal-body').html(`
                <p>${product.description}</p>
                <p>Price: PKR ${product.price}</p>
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" class="form-control" value="1" min="1">
            `);

            // Set the product index to add to cart from modal
            $('#addToCartBtnModal').off('click').on('click', function() {
                const quantity = parseInt($('#quantity').val());
                addToCart(product, quantity);
                $('#productModal').modal('hide');
            });
        });

        // Handle "Add to Cart" button on the product page
        $(document).on('click', '.add-to-cart-btn', function() {
            const index = $(this).data('index');
            const product = products[index];
            const quantity = 1; // Default quantity is 1 for this button

            addToCart(product, quantity);
        });

        // Handle checkout (open address modal)
        $('#checkoutBtn').click(function() {
            $('#addressModal').modal('show');
        });
    });

    // Function to add product to cart
    function addToCart(product, quantity) {
        const cartItem = cart.find(item => item.name === product.name);
        
        if (cartItem) {
            cartItem.quantity += quantity;
        } else {
            cart.push({ ...product, quantity });
        }

        updateCart();
    }

    // Function to update cart
    function updateCart() {
        const cartList = $('#cart-list');
        cartList.empty();

        cart.forEach(item => {
            cartList.append(`
                <li>
                    ${item.name} (x${item.quantity}) - PKR ${item.price * item.quantity} 
                    <input type="number" class="form-control quantity-input" data-name="${item.name}" value="${item.quantity}" min="1" style="width: 60px; display: inline-block;">
                    <button class="btn btn-danger btn-sm remove-item" data-name="${item.name}">Remove</button>
                </li>
            `);
        });
    }

    // Handle quantity change in the cart
    $(document).on('change', '.quantity-input', function() {
        const productName = $(this).data('name');
        const newQuantity = parseInt($(this).val());

        const cartItem = cart.find(item => item.name === productName);
        if (cartItem) {
            cartItem.quantity = newQuantity;
        }

        updateCart();
    });

    // Handle item removal from cart
    $(document).on('click', '.remove-item', function() {
        const productName = $(this).data('name');
        cart = cart.filter(item => item.name !== productName);
        updateCart();
    });

    // Handle address form submission
    $('#address-form').submit(function(e) {
        e.preventDefault();

        const name = $('#name').val();
        const phone = $('#phone').val();
        const city = $('#city').val();
        const address = $('#address').val();

        // Prepare WhatsApp message
        let message = "Order Details:\n";
        cart.forEach(item => {
            message += `${item.name} (x${item.quantity}) - PKR ${item.price * item.quantity}\n`;
        });
        message += `\nTotal: PKR ${cart.reduce((total, item) => total + (item.price * item.quantity), 0)}\n`;
        message += `\nShipping Address:\nName: ${name}\nPhone: ${phone}\nCity: ${city}\nAddress: ${address}\n`;

        // Open WhatsApp with the message (this will open WhatsApp with a pre-filled message)
        const phoneNumber = '923064759958'; // Your WhatsApp business number
        const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');

        // Close modal after submission
        $('#addressModal').modal('hide');

        // Show Thank You message
        alert('Thank you for your order!');
    });
</script>

</body>
</html>
